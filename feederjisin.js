javascript:(()=>{const API="https://api.p2pquake.net/v2/jma/quake?limit=1";const POST="https://www1.x-feeder.info/lo18bx2n/post_feed.php";const START=Date.now();let sent=new Set();const allowLow=confirm("震度2以下も通知する？");const askSpecial=confirm("震度5強以上を is_special=1 にする？");async function send(name,comment,is_special){  const fd=new FormData();  fd.append("name",name);  fd.append("comment",comment);  fd.append("is_special",String(is_special));  fd.append("category_id","0");  await fetch(POST,{method:"POST",body:fd,credentials:"include"});}async function check(){  try{    const r=await fetch(API);    const j=await r.json();    if(!Array.isArray(j))return;    for(const d of j){      if(sent.has(d.id))continue;      const t=new Date(d.earthquake?.time||0).getTime();      if(!t||t<START)continue;      if(d.code===551){        const scale=d.earthquake.maxScale?d.earthquake.maxScale/10:0;        if(scale<=2 && !allowLow){ sent.add(d.id); continue; }        let is_special=0;        if(scale>=5.5 && askSpecial) is_special=1;        const place=d.earthquake.hypocenter?.name||"不明";        const mag=d.earthquake.hypocenter?.magnitude||"不明";        const msg=`地震の情報が入りました。震源地は ${place} です。地震の強さは 震度${scale||"不明"} です。マグニチュードは ${mag}M です。以上みかんからお伝えしました。`;        await send("Σsuicided_m!kan!",msg,is_special);        sent.add(d.id);      }      if(d.code===556){        const time=d.earthquake.time||"";        const place=d.earthquake.hypocenter?.name||"不明";        const msg=`${time} 地震速報が発令されました ${place} 揺れに注意してください`;        await send("Σsuicided_m!kan!",msg,0);        sent.add(d.id);      }      if(d.code===552){        const tsunami=d.earthquake.domesticTsunami||"不明";        let major=[],warn=[],adv=[];        if(Array.isArray(d.areas)){          d.areas.forEach(a=>{            if(a.grade==="MajorWarning")major.push(a.name);            if(a.grade==="Warning")warn.push(a.name);            if(a.grade==="Advisory")adv.push(a.name);          });        }        const msg=`地震の情報です。津波${tsunami}が発令されました。発令地域:\n${major.length?"大津波警報\n"+major.join("\n")+"\n":""}${warn.length?"津波警報\n"+warn.join("\n")+"\n":""}${adv.length?"津波注意報\n"+adv.join("\n")+"\n":""}以上みかんからお伝えしました。`;        await send("Σsuicided_m!kan!",msg,0);        sent.add(d.id);      }    }  }catch(e){}}setInterval(check,12000);})();
